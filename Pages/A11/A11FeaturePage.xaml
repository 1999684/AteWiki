<Page x:Class="AtelierWiki.Pages.A11.A11FeaturePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:vm="clr-namespace:AtelierWiki.ViewModels"
      xmlns:converters="clr-namespace:AtelierWiki.Converters" 
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="A11 Features">

    <Page.DataContext>
        <vm:A11FeatureViewModel/>
    </Page.DataContext>

    <Page.Resources>
        <!-- 1. 基础色板 -->
        <SolidColorBrush x:Key="TechBgBrush" Color="#0F172A"/>
        <SolidColorBrush x:Key="TechPanelBrush" Color="#1E293B"/>
        <SolidColorBrush x:Key="TechAccentBrush" Color="#00F0FF"/>
        <SolidColorBrush x:Key="TechTextBrush" Color="#E2E8F0"/>
        <SolidColorBrush x:Key="TechDimTextBrush" Color="#94A3B8"/>

        <converters:BoolToVisibilityConverter x:Key="BoolToVis"/>

        <x:Array x:Key="BoolOptions" Type="sys:Boolean">
            <sys:Boolean>True</sys:Boolean>
            <sys:Boolean>False</sys:Boolean>
        </x:Array>

        <!-- 2. 样式定义 -->

        <!-- 2.1 滚动条 -->
        <Style x:Key="TechScrollBarStyle" TargetType="{x:Type ScrollBar}">
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Width" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid Background="Transparent">
                            <Track Name="PART_Track" IsDirectionReversed="true">
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate>
                                                <Border x:Name="ThumbBorder" Background="#3300F0FF" CornerRadius="4"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="{StaticResource TechAccentBrush}"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 2.2 编辑框 (TextBox) -->
        <Style x:Key="InlineEditBox" TargetType="TextBox">
            <Setter Property="Background" Value="#0B0E14"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#444"/>
            <Setter Property="CaretBrush" Value="{StaticResource TechAccentBrush}"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- 2.3 居中显示的文本 (CenterText) -->
        <Style x:Key="CenterText" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- ============================================== -->
        <!-- 2.4 【核心修复】暗黑科技风下拉框 (ComboBox) -->
        <!-- ============================================== -->
        <Style x:Key="InlineComboBox" TargetType="ComboBox">
            <Setter Property="Height" Value="22"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- 按钮背景 -->
                            <ToggleButton Name="ToggleButton" 
                                          BorderBrush="#444" 
                                          BorderThickness="1" 
                                          Background="#0B0E14" 
                                          Focusable="false"
                                          IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border x:Name="Border" 
                                                Background="{TemplateBinding Background}" 
                                                BorderBrush="{TemplateBinding BorderBrush}" 
                                                BorderThickness="{TemplateBinding BorderThickness}" 
                                                CornerRadius="2"/>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="true">
                                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource TechAccentBrush}" />
                                                <Setter TargetName="Border" Property="Background" Value="#1E293B" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>

                            <!-- 选中的内容 -->
                            <ContentPresenter Name="ContentSite" 
                                              IsHitTestVisible="False" 
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="5,0,20,0"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center" />

                            <!-- 下拉箭头 -->
                            <Path x:Name="Arrow" 
                                  Data="M 0 0 L 4 4 L 8 0 Z" 
                                  Fill="{StaticResource TechAccentBrush}"
                                  HorizontalAlignment="Right" 
                                  VerticalAlignment="Center" 
                                  Margin="0,0,6,0" 
                                  IsHitTestVisible="False"/>

                            <!-- 弹出层 (Popup) -->
                            <Popup Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True" 
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">

                                    <!-- 下拉菜单背景 (深色) -->
                                    <Border x:Name="DropDownBorder" 
                                            Background="#0F172A" 
                                            BorderThickness="1" 
                                            BorderBrush="{StaticResource TechAccentBrush}"
                                            CornerRadius="2"/>

                                    <ScrollViewer Margin="1" SnapsToDevicePixels="True">
                                        <ScrollViewer.Resources>
                                            <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource TechScrollBarStyle}"/>
                                        </ScrollViewer.Resources>
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <!-- 列表项样式 -->
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="SnapsToDevicePixels" Value="True"/>
                        <Setter Property="Padding" Value="4"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border x:Name="Bd" 
                                            Background="{TemplateBinding Background}" 
                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                            BorderThickness="{TemplateBinding BorderThickness}" 
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#1E293B"/>
                                            <Setter Property="Foreground" Value="{StaticResource TechAccentBrush}"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#3300F0FF"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>

            <!-- 选项显示模板 (True=O, False=-) -->
            <Setter Property="ItemTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="-"/>
                                    <Setter Property="Foreground" Value="#64748B"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="True">
                                            <Setter Property="Text" Value="O"/>
                                            <Setter Property="Foreground" Value="#00F0FF"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 2.5 标志位文本显示样式 -->
        <Style x:Key="FlagStyle" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Self}}" Value="O">
                    <Setter Property="Foreground" Value="{StaticResource TechAccentBrush}"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#00F0FF" BlurRadius="5" ShadowDepth="0"/>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
                <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource Self}}" Value="">
                    <Setter Property="Text" Value="·"/>
                    <Setter Property="Foreground" Value="#33475D6F"/>
                    <Setter Property="FontSize" Value="20"/>
                    <Setter Property="Margin" Value="0,-8,0,0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Page.Resources>

    <Grid Background="{StaticResource TechBgBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 1. 顶部操作栏 -->
        <Border Grid.Row="0" BorderBrush="#33475D6F" BorderThickness="0,0,0,1" Background="#05FFFFFF">
            <Grid Margin="20,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <Image Source="/Assets/Icon/search.png" Width="18" Height="18" Margin="0,0,12,0" VerticalAlignment="Center" RenderOptions.BitmapScalingMode="HighQuality"/>
                    <Border BorderBrush="#33475D6F" BorderThickness="1" CornerRadius="2" Padding="5" Width="250" Background="#0B0E14">
                        <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                 BorderThickness="0" Background="Transparent" 
                                 Foreground="White" CaretBrush="{StaticResource TechAccentBrush}"
                                 VerticalContentAlignment="Center" FontSize="14"/>
                    </Border>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Command="{Binding AddNewCommand}" Margin="0,0,20,0" Background="Transparent" BorderThickness="0" Cursor="Hand" Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVis}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="+" Foreground="#00FF00" FontSize="18" FontWeight="Bold" Margin="0,0,5,0"/>
                            <TextBlock Text="NEW ROW" Foreground="#00FF00" VerticalAlignment="Center" FontWeight="Bold" FontFamily="Consolas"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding ToggleEditCommand}" Background="Transparent" BorderThickness="0" Cursor="Hand">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Image Source="/Assets/Icon/edit.png" Width="20" Height="20" Margin="0,0,10,0" VerticalAlignment="Center" RenderOptions.BitmapScalingMode="HighQuality">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Setter Property="Opacity" Value="0.5"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Opacity" Value="0.8"/>
                                            </Trigger>
                                            <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                                <Setter Property="Opacity" Value="1.0"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#00F0FF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <Border Width="8" Height="8" CornerRadius="4" BorderBrush="#555" BorderThickness="1">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                                <Setter Property="Background" Value="{StaticResource TechAccentBrush}"/>
                                                <Setter Property="BorderBrush" Value="{StaticResource TechAccentBrush}"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#00F0FF" BlurRadius="6" ShadowDepth="0"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 2. 数据表格 -->
        <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding DisplayList}"
                  AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="False"
                  EnableRowVirtualization="True" VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling" ScrollViewer.CanContentScroll="True"
                  HeadersVisibility="Column" GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#33475D6F" VerticalGridLinesBrush="Transparent"
                  Background="Transparent" BorderThickness="0" RowBackground="Transparent" AlternatingRowBackground="#05FFFFFF"
                  Foreground="{StaticResource TechTextBrush}" Margin="20" RowHeight="35">

            <DataGrid.Resources>
                <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource TechScrollBarStyle}"/>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <!-- 中文名稱 -->
                <DataGridTemplateColumn Header="中文名稱" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="{StaticResource TechAccentBrush}" VerticalAlignment="Center"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineEditBox}"
                                         Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 延长 (修正：现在绑定到 IsExtension 并使用 ComboBox) -->
                <DataGridTemplateColumn Header="延" Width="40">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <!-- 显示态：使用 ExtensionDisplay (显示 'O' 或 '-') -->
                                <TextBlock Text="{Binding ExtensionDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>

                                <!-- 编辑态：使用 ComboBox 选择 True/False -->
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" 
                                          SelectedItem="{Binding IsExtension, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                          Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Cost -->
                <DataGridTemplateColumn Header="Cost" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding Cost}" Foreground="Yellow" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <TextBox Text="{Binding Cost, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineEditBox}" HorizontalContentAlignment="Center"
                                         Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 调 -->
                <DataGridTemplateColumn Header="調" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding SynthesizeDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsSynthesize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 攻 -->
                <DataGridTemplateColumn Header="攻" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding AttackDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsAttack, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 回 -->
                <DataGridTemplateColumn Header="回" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding HealDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsHeal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 武 -->
                <DataGridTemplateColumn Header="武" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding WeaponDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsWeapon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 防 -->
                <DataGridTemplateColumn Header="防" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding ArmorDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsArmor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 装 -->
                <DataGridTemplateColumn Header="裝" Width="35">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding AccessoryDisplay}" Style="{StaticResource FlagStyle}"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <ComboBox ItemsSource="{StaticResource BoolOptions}" SelectedItem="{Binding IsAccessory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineComboBox}"
                                          Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 说明 -->
                <DataGridTemplateColumn Header="說明" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding Description}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Foreground="#DDD"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineEditBox}"
                                         Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 附注 -->
                <DataGridTemplateColumn Header="附註" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <TextBlock Text="{Binding Note}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Foreground="#999" FontStyle="Italic"
                                           Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}"/>
                                <TextBox Text="{Binding Note, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InlineEditBox}"
                                         Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- 删除按钮 -->
                <DataGridTemplateColumn Width="40">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="×" Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=Page}}" 
                                    CommandParameter="{Binding}"
                                    Foreground="Red" Background="Transparent" BorderThickness="0" FontWeight="Bold" Cursor="Hand"
                                    Visibility="{Binding DataContext.IsEditMode, RelativeSource={RelativeSource AncestorType=Page}, Converter={StaticResource BoolToVis}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>

            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#1E293B"/>
                    <Setter Property="Foreground" Value="#94A3B8"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="BorderThickness" Value="0,0,0,2"/>
                    <Setter Property="BorderBrush" Value="#33475D6F"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#2200F0FF"/>
                            <Setter Property="BorderBrush" Value="{StaticResource TechAccentBrush}"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#11FFFFFF"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="DataGridCell">
                                <Border Background="{TemplateBinding Background}">
                                    <ContentPresenter VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>

        </DataGrid>
    </Grid>
</Page>
